pipeline {
    agent any

    stages {
        stage('Execute Script') {
            steps {
                script {
                    // Specify the path to your local Jenkinsfile
                    def scriptPath = '/home/ubuntu/jenkinscript1.sh'
                    def logFilePath = '/tmp/logfile.txt'

                    // Execute the Jenkinsfile and redirect output to /tmp/logfile.txt
                    sh "bash ${scriptPath} > ${logFilePath} 2>&1"

                    // Print the log file content for debugging (optional)
                    echo "Script Output:"
                    def scriptOutput = readFile(logFilePath)
                    echo scriptOutput

                    // Send success notification to Telegram
                    sendTelegramNotification(scriptOutput)
                }
            }
        }

        stage('Success Notification') {
            when {
                expression { currentBuild.resultIsBetterOrEqualTo('SUCCESS') }
            }
            steps {
                script {
                    sendTelegramNotification("Jenkins Job Completed Successfully. Logging result saved")
                }
            }
        }
    }
}

// Define the sendTelegramNotification function outside the pipeline block
def sendTelegramNotification(msg) {
    sh "curl -X POST -H 'Content-Type: application/json' -d '{\"chat_id\": \"2120613878\", \"text\": \"$msg\", \"disable_notification\": true}' https://api.telegram.org/bot6964667296:AAF8Bv8XibWEPeQ4CQCL5htOfEVJTrffhHs/sendMessage"
}
